{% extends "words/visualization_generic.html" %}

{% block scripts %}<!--Specific script(s) used for word frequencies visualization-->{% endblock %}

{% block legend %}
    <p><strong>words displayed: {{ wordcount }}</strong></p>
{% endblock %}

{% block viz %}
<script type="module">

// Load the D3 Observable runtime and inspector.
import {Runtime, Inspector} from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";

// Word Frequency Bubble Chart notebook, compiled as an ES module.
import notebook from "https://api.observablehq.com/@joncros/bubble-chart.js?v=3";

// Load the Bubble Chart
const main = new Runtime().module(notebook, name => {
  if (name === "chart") {
    return new Inspector(document.querySelector("#visualization"));
  }
});

new Runtime().module(notebook, name => {
  return {
    pending() { console.log(`${name} is runningâ€¦`); },
    fulfilled(value) { console.log(name, value); },
    rejected(error) { console.error(error); }
  };
});

{% if wordset_data %}

var wordset_data = {{wordset_data|safe }};

//Reload bubble chart with data from chosen word set
main.redefine("data", wordset_data);
//main.redefine("v", 22);
{% endif %}
</script>
{% endblock %}

{% block visualization_form %}
    <p>Select Word Set to generate visualization from</p>
    <form class="form-inline" action="" method="post">
        <!--Form used to choose a WordSet to generate the visualization from-->
        {% csrf_token %}
        {{ form }}
        <input type="submit" value="Submit">
        <p><a href="{% url 'wordset_create' %}?next={{request.path}}">Create New Word Set</a></p>
    </form>
{% endblock %}